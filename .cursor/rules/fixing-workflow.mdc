---
description: "Workflow for fixing lint, type, test, and build failures. Follow this process whenever resolving multiple errors."
alwaysApply: true
---

# Fixing Workflow

When fixing lint errors, type errors, test failures, or build failures, always follow this exact process. Never skip steps or take shortcuts.

## Step 1: Discover ALL Failures

Run the appropriate command to get the full picture before touching any code:

| Category            | Discovery command          |
|---------------------|----------------------------|
| Lint                | `npm run lint`             |
| Format              | `npm run format`           |
| Type errors         | `npm run typecheck`        |
| Unit tests          | `npm run test:unit`        |
| Integration tests   | `npm run test:integration` |
| Build               | `npm run build`            |

Read the complete output.

## Step 2: Create a Task List of ALL Failures

Before fixing anything, catalog every failure into a task list:
- One item per distinct error/failure (group related errors in the same file)
- Include the file path and a short description of the issue
- Mark all items as pending

Example:
```
[ ] src/core/session-stream.ts -- missing return type on `handleChunk()`
[ ] src/store/app-store.ts -- unused import `SessionMode`
[ ] __tests__/unit/core/message-handler.unit.test.ts -- assertion fails (expected 'pending', got null)
```

## Step 3: Fix Each Issue Individually

For each item in the task list:
1. Read the failing file and understand the root cause
2. Apply the minimal, correct fix
3. Verify the fix by running ONLY the affected scope:

| Category     | Verify single fix                    |
|--------------|--------------------------------------|
| Lint         | `npx biome check <file>`            |
| Type errors  | `npm run typecheck`                  |
| Unit test    | `npx vitest run <test-file>`         |
| Build        | `npm run build`                      |

4. Mark the item as done only after the individual verification passes
5. If the fix introduces a new error, fix that before moving on

## Step 4: Do NOT Run the Full Suite Until All Items Are Resolved

- Iterate through the task list one item at a time
- Do not run `npm test`, `npm run lint`, or full suites until every item is checked off
- This avoids wasting time on long suite runs while issues remain

## Step 5: Run the Full Suite to Confirm

Once all items are individually resolved:
1. Run the full command from Step 1
2. If new failures appear (regressions from fixes), go back to Step 2 with only the new failures
3. Repeat until the suite passes cleanly
4. Run `npm run lint && npm run typecheck` as a final gate
