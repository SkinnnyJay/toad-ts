---
title: Repository Guidelines
date: 2025-01-27
author: Jonathan Boice
status: approved
lastUpdated: 2025-01-27
---

# Repository Guidelines

## Project Structure & Module Organization
- `src/utils/` holds the production TypeScript utilities, grouped by domain:
  - `env/` for environment parsing and validation.
  - `logging/` for logger setup and correlation context.
  - `token-optimizer/` for the core optimizer, strategies, telemetry, and stubs.
- `scratchpad/` is experimental research code; avoid shipping changes from here.
- `dist/` is build output (generated by `npm run build`).
- Root configs include `tsup.config.ts`, `vitest.config.ts`, `tsconfig.json`, and `biome.json`.

## Build, Test, and Development Commands
- `npm run dev`: run the CLI directly from `src/` via `tsx`.
- `npm run dev:watch`: re-run the CLI on file changes.
- `npm run build`: bundle to `dist/` with `tsup`.
- `npm start`: execute the compiled CLI from `dist/`.
- `npm test`: run all tests with Vitest.
- `npm run test:watch`: watch mode for tests.
- `npm run test:coverage`: generate coverage reports.
- `npm run lint` / `npm run lint:fix`: Biome linting, with optional fixes.
- `npm run format`: format with Biome.
- `npm run typecheck`: TypeScript type-check only.

## Coding Style & Naming Conventions
- TypeScript, ESM-only (`"type": "module"`), `strict` mode enabled.
- Biome enforces 2-space indent, 100 char line width, double quotes, and semicolons.
- Use the existing naming patterns: camelCase files like `tokenOptimizer.ts`, utility suffixes like `*.utils.ts`, and type files like `*.types.ts`.
- Path alias `@/` maps to `src/` (e.g., `@/utils/env`).

## Testing Guidelines
- Framework: Vitest with globals enabled.
- Test files use `<filename>.<unit | integration>.test.ts` naming convention.
- All test files are located in `__tests__/<unit | integration>/` directory structure.
- Examples:
  - Unit tests: `__tests__/unit/core/message-handler.unit.test.ts`
  - Integration tests: `__tests__/integration/core/session-stream.integration.test.ts`
- Run a single test with `npx vitest run __tests__/unit/utils/env.utils.unit.test.ts`.

## Commit & Pull Request Guidelines
- No commit history exists yet, so no established convention; use concise, imperative messages (e.g., `Add token telemetry storage`).
- PRs should include a short summary, tests run, and note any config or env changes.
- Link related issues and include screenshots only if UI output changes.

## Security & Configuration Tips
- Use `.env.sample` to create local `.env`; never commit secrets.
- Required keys include `OPENAI_API_KEY` and `ANTHROPIC_API_KEY`; optional settings include `LOG_LEVEL` and rate-limit caps.
- Target Node.js 20+ per `package.json` engines.

## Execution Verification Policy (MANDATORY)
- Never claim lint/typecheck/test/build/dev were run unless the exact commands completed successfully in this workspace.
- For every change cycle, run and report actual command output for: `npm run lint`, `npm run typecheck`, `npm run test` (project suites), and `npm run build` before stating readiness. If any are skipped, explicitly state they were not run and why.
- Exclude third-party/vendor/research suites from test runs via config (already set in `vitest.config.ts`); do not mask project failures.
- If any command fails, surface the error, do not downgrade severity, and do not proceed as “green”.
- Final responses must list the commands actually executed and their status (pass/fail), or explicitly state if a command was not executed.
